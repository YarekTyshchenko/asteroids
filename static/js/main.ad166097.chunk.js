(this.webpackJsonpasteroids=this.webpackJsonpasteroids||[]).push([[0],{31:function(e,t,n){e.exports=n(64)},36:function(e,t,n){},37:function(e,t,n){},61:function(e,t){},64:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),o=n(29),a=n.n(o),c=(n(36),n(37),n(1));var u=function(e){var t=r.useRef(),n=r.useRef();r.useEffect((function(){return t.current=requestAnimationFrame((function r(i){if(void 0!==n.current){var o=i-n.current;e(o)}n.current=i,t.current=requestAnimationFrame(r)})),function(){t.current&&cancelAnimationFrame(t.current)}}),[t,n,e])};function l(e){var t=r.useState(!1),n=Object(c.a)(t,2),i=n[0],o=n[1];return r.useEffect((function(){function t(t){t.key===e&&o(!0)}var n=function(t){t.key===e&&o(!1)};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}}),[e]),i}var s=function(e){var t=r.useState(e.refObject.current),n=Object(c.a)(t,2),i=n[0],o=n[1];return r.useLayoutEffect((function(){e.refObject.current&&o(e.refObject.current)}),[e.refObject]),i?e.children(i):null},f=function(e){var t=e.children,n=r.createRef();return r.createElement(r.Fragment,null,r.createElement("canvas",{ref:n}),r.createElement(s,{refObject:n},(function(e){return r.createElement(h,{canvas:e,childrenFn:t})})))},h=function(e){var t=e.canvas,n=e.childrenFn,i=t.getContext("2d"),o=r.useState({ctx:i,height:t.height,width:t.width}),a=Object(c.a)(o,2),l=a[0],s=a[1];return u((function(e){!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e.clientWidth*t|0,r=e.clientHeight*t|0;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}(t),s({ctx:i,height:t.height,width:t.width})})),n(l)},d=function(e){var t=e.canvas,n=e.children,i=r.useState({width:t.width,height:t.height}),o=Object(c.a)(i,2),a=o[0],u=o[1];return r.useEffect((function(){u({width:t.width,height:t.height})}),[t.width,t.height]),n(a)},m=function(e){var t,n=e.width,i=e.height,o=e.playerShip;return r.createElement("div",{className:"absolute sector"},"Sector ",((t=Math.round(o.position.x/n))<0?"-":"")+function e(t){return(t>=26?e(Math.floor(t/26)-1):"")+"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[t%26]}(Math.abs(t)),Math.round(o.position.y/i))},v=function(e){var t=e.socket,n=l("ArrowUp"),i=l("ArrowLeft"),o=l("ArrowRight"),a=l(" ");return r.useEffect((function(){n?t.emit("command","thrust-start"):t.emit("command","thrust-end")}),[t,n]),r.useEffect((function(){i?t.emit("command","turn-left"):t.emit("command","turn-end")}),[t,i]),r.useEffect((function(){o?t.emit("command","turn-right"):t.emit("command","turn-end")}),[t,o]),r.useEffect((function(){a&&t.emit("command","fire")}),[t,a]),r.createElement(r.Fragment,null)},p=function(e){var t=e.children,n=e.world,i=r.useState(),o=Object(c.a)(i,2),a=o[0],u=o[1];return r.useEffect((function(){var e=n.playerShip.subscribe((function(e){u(e)}));return function(){return e.unsubscribe()}})),a?t(a):r.createElement("p",null,"Waiting for player ship")},w=function(e){var t=e.world,n=r.useState(t.score.currentScore()),i=Object(c.a)(n,2),o=i[0],a=i[1];return r.useEffect((function(){t.score.score.subscribe((function(e){a(t.score.currentScore())}))})),r.createElement("div",{className:"absolute score"},"Score: ",o)},y=n(2),g=n.n(y),E=function(e){var t=e.canvas,n=e.world,r=e.socket;return u((function(e){var i=Date.now(),o=n.ships(i),a=n.shells(),c=n.hits(),u=n.asteroids(),l=function(e,t,n,r){var i=t.find((function(t){return t.id===e}));return i?{x:Math.round(i.position.x/n)*n,y:Math.round(i.position.y/r)*r}:{x:0,y:0}}(r.id,o,t.width,t.height),s=b(t.ctx,l);s.text(n.debug(),10,10,"gray"),c.forEach((function(e){s.hit(e)})),a.forEach((function(e){s.shell(e)})),o.forEach((function(e){s.ship(e)})),u.forEach((function(e){s.asteroid(e)}))})),null},b=function(e,t){var n=e.canvas.clientWidth,r=e.canvas.clientHeight,i=function(e){return{x:e.x-t.x+n/2,y:e.y-t.y+r/2}};e.font="8pt Mono",e.clearRect(0,0,n,r),e.fillStyle="black",e.fillRect(0,0,n,r);var o=function(t){e.moveTo(t+.5,0),e.lineTo(t+.5,r)},a=function(t){e.moveTo(0,t+.5),e.lineTo(n,t+.5)},u=[new g.a(10,0),new g.a(-5,-5),new g.a(-5,5)],l=[new g.a(-5,-2),new g.a(-10,0),new g.a(-5,2)];return{asteroid:function(t){var n=i(t.position);e.beginPath(),e.arc(n.x,n.y,t.mass/2,0,2*Math.PI,!1),e.stroke()},ship:function(t){e.fillStyle="white";var n=i(t.position),r=new g.a(n.x,n.y);e.lineWidth=1,e.strokeStyle="white",e.fillStyle="black";var o=u.map((function(e){return e.clone().rotate(t.bearing).add(new g.a(n.x,n.y))})),a=Object(c.a)(o,3),s=a[0],f=a[1],h=a[2];if(e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(f.x,f.y),e.lineTo(h.x,h.y),e.lineTo(s.x,s.y),e.closePath(),e.fill(),e.stroke(),t.thrust>0){var d=l.map((function(e){return e.clone().rotate(t.bearing).add(r)})),m=Object(c.a)(d,3),v=m[0],p=m[1],w=m[2];e.beginPath(),e.moveTo(v.x,v.y),e.lineTo(p.x,p.y),e.lineTo(w.x,w.y),e.stroke()}},shell:function(t){e.lineWidth=1,e.strokeStyle="white",e.beginPath();var n=i(t.position),r=new g.a(5,0).rotate(t.bearing).add(new g.a(n.x,n.y));e.moveTo(n.x,n.y),e.lineTo(r.x,r.y),e.stroke()},hit:function(t){e.lineWidth=1;var n=Math.round(255*(1-t.phase)).toString(16).padStart(2,"0");e.strokeStyle="#".concat(n).concat(n).concat(n);var r=i(t.position);e.beginPath(),e.arc(r.x,r.y,20*t.phase,0,2*Math.PI,!1),e.stroke()},centreGraduation:function(){e.strokeStyle="#333333",e.lineWidth=1,e.beginPath(),e.moveTo(0,Math.floor(r/2)+.5),e.lineTo(n,Math.floor(r/2)+.5),e.moveTo(Math.floor(n/2)+.5,0),e.lineTo(Math.floor(n/2)+.5,r),e.stroke()},text:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"white";e.fillStyle=i,e.fillText(t,n,r)},grid:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;e.strokeStyle="#555555",e.lineWidth=1,e.beginPath();for(var c=0;c<n+i;c+=i){var u=Math.floor(c+(n/2-t.x)%i);o(u)}for(var l=0;l<r+i;l+=i){var s=Math.floor(l+(r/2-t.y)%i);a(s)}e.stroke(),e.fillStyle="white";for(var f=0;f<n+i;f+=100){var h=f+(n/2-t.x)%i;e.fillText((Math.ceil((t.x-n/2+f)/i)*i).toFixed(0).toString(),h,100)}for(var d=0;d<r+i;d+=100){var m=d+(r/2-t.y)%i;e.fillText((Math.ceil((t.y-r/2+d)/i)*i).toFixed(0).toString(),5,m)}}}},S=n(30).connect(Object({NODE_ENV:"production",PUBLIC_URL:"/asteroids"}).REACT_APP_SOCKET||"https://asteroids.yarekt.co.uk"),x=r.createContext(S).Consumer,k=n(66),T=function(){var e=new Array,t=new Array,n=new Array,r=new Array,i=new k.a,o=function(){var e=0,t=new k.a;return t.subscribe((function(t){e+=t})),{currentScore:function(){return e},score:t}}(),a=new Array,c=new Array,u="Debug",l=function(e){return String(Math.round(e)).padStart(3)};return{playerShip:i,debug:function(){return u},hits:function(){return r.forEach((function(e){return e.phase+=1/60})),r=r.filter((function(e){return e.phase<1}))},addHit:function(e){r.push({position:e.position,phase:0})},incrementScore:function(){o.score.next(1)},decrementScore:function(){o.score.next(-1)},score:o,ships:function(t){return e},shells:function(){return t},asteroids:function(){return n},update:function(r){e=r.ships,t=r.shells,n=r.asteroids;var i=Date.now()-r.time;a.unshift(r.simulationTime),a.length>60&&a.pop();var o=a.reduce((function(e,t){return e+t}),0)/60;c.unshift(r.sendTime),c.length>60&&c.pop();var s=c.reduce((function(e,t){return e+t}),0)/60;u="Delay: ".concat(l(i),"ms Simulation time: ").concat(l(r.simulationTime),"ms (").concat(l(o),"ms) ").concat(l(o/16.6*100),"%, sendTime: ").concat(l(r.sendTime),"ms (").concat(l(s),"ms) ").concat(l(s/16.6*100),"%, Inter-frame delay: ").concat(l(r.frameGap),"ms")}}}(),M=r.createContext(T),A=M.Consumer,O=function(){return r.createElement("div",{className:"App"},r.createElement("header",{className:"App-header"},r.createElement(A,null,(function(e){return r.createElement(x,null,(function(t){return r.createElement(r.Fragment,null,r.createElement(f,null,(function(n){return r.createElement(r.Fragment,null,r.createElement(E,{canvas:n,socket:t,world:e}),r.createElement(d,{canvas:n},(function(t){var n=t.width,i=t.height;return r.createElement(p,{world:e},(function(e){return r.createElement(m,{width:n,height:i,playerShip:e})}))})))})),r.createElement(v,{socket:t}),r.createElement(w,{world:e}))}))}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(i.a.createElement((function(e){var t=e.children;return r.createElement(M.Provider,{value:T},r.createElement(x,null,(function(e){return e.on("update",(function(t){if(T.update(t),!T.playerShip.isStopped){var n=t.ships.find((function(t){return t.id===e.id}));n&&T.playerShip.next(n)}})),e.on("shellHitShip",(function(t){T.addHit(t),t.target===e.id||"earth"===t.target?T.decrementScore():t.owner===e.id&&T.incrementScore()})),r.createElement(r.Fragment,null,t)})))}),null,i.a.createElement(O,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[31,1,2]]]);
//# sourceMappingURL=main.ad166097.chunk.js.map