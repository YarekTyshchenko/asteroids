(this.webpackJsonpasteroids=this.webpackJsonpasteroids||[]).push([[0],{31:function(e,t,n){e.exports=n(64)},36:function(e,t,n){},37:function(e,t,n){},61:function(e,t){},64:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(29),a=n.n(i),c=(n(36),n(37),n(4));function u(e){var t=r.useState(!1),n=Object(c.a)(t,2),o=n[0],i=n[1];return r.useEffect((function(){function t(t){t.key===e&&i(!0)}var n=function(t){t.key===e&&i(!1)};return window.addEventListener("keydown",t),window.addEventListener("keyup",n),function(){window.removeEventListener("keydown",t),window.removeEventListener("keyup",n)}}),[e]),o}var l=function(e){var t=e.socket,n=u("ArrowUp"),o=u("ArrowLeft"),i=u("ArrowRight"),a=u(" ");return r.useEffect((function(){n?t.emit("command","thrust-start"):t.emit("command","thrust-end")}),[t,n]),r.useEffect((function(){o?t.emit("command","turn-left"):t.emit("command","turn-end")}),[t,o]),r.useEffect((function(){i?t.emit("command","turn-right"):t.emit("command","turn-end")}),[t,i]),r.useEffect((function(){a&&t.emit("command","fire")}),[t,a]),r.createElement(r.Fragment,null)},s=n(1),f=n.n(s),m=function(e){var t=e.world,n=e.zoom,o=r.useState(t.score()),i=Object(c.a)(o,2),a=i[0],u=i[1],l=r.createRef();return function(e){var t=r.useRef(),n=r.useRef();r.useEffect((function(){return t.current=requestAnimationFrame((function r(o){if(void 0!==n.current){var i=o-n.current;e(i)}n.current=o,t.current=requestAnimationFrame(r)})),function(){t.current&&cancelAnimationFrame(t.current)}}),[t,n,e])}((function(e){var r=Date.now(),o=t.ships(r),i=t.shells(),a=t.hits();u(t.score());var c=l.current;if(c){!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e.clientWidth*t|0,r=e.clientHeight*t|0;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r,console.log("W: ".concat(e.clientHeight," H: ").concat(e.clientWidth)))}(c);var s=c.getContext("2d"),f=h(s,{x:0,y:0},n);f.text(t.debug(),10,10,"gray"),a.forEach((function(e){f.hit(e)})),i.forEach((function(e){f.shell(e)})),o.forEach((function(e){f.ship(e)}))}})),r.createElement(r.Fragment,null,r.createElement("canvas",{ref:l}),r.createElement("div",{className:"absolute score"},"Score: ",a))},h=function(e,t,n){var r=e.canvas.clientWidth,o=e.canvas.clientHeight,i=function(e){return{x:e.x/n-t.x/n+r/2,y:e.y/n-t.y/n+o/2}};e.font="8pt Mono",e.clearRect(0,0,r,o),e.fillStyle="black",e.fillRect(0,0,r,o);var a=function(t){e.moveTo(t+.5,0),e.lineTo(t+.5,o)},u=function(t){e.moveTo(0,t+.5),e.lineTo(r,t+.5)},l=[new f.a(10,0),new f.a(-5,-5),new f.a(-5,5)],s=[new f.a(-5,-2),new f.a(-10,0),new f.a(-5,2)];return{ship:function(t){e.fillStyle="white";var n=i(t.position),r=new f.a(n.x,n.y);e.lineWidth=1,e.strokeStyle="white",e.fillStyle="black";var o=l.map((function(e){return e.clone().rotate(t.bearing).add(new f.a(n.x,n.y))})),a=Object(c.a)(o,3),u=a[0],m=a[1],h=a[2];if(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(m.x,m.y),e.lineTo(h.x,h.y),e.lineTo(u.x,u.y),e.closePath(),e.fill(),e.stroke(),t.thrust>0){var d=s.map((function(e){return e.clone().rotate(t.bearing).add(r)})),v=Object(c.a)(d,3),w=v[0],y=v[1],p=v[2];e.beginPath(),e.moveTo(w.x,w.y),e.lineTo(y.x,y.y),e.lineTo(p.x,p.y),e.stroke()}},shell:function(t){e.lineWidth=1,e.strokeStyle="white",e.beginPath();var n=i(t.position),r=new f.a(5,0).rotate(t.bearing).add(new f.a(n.x,n.y));e.moveTo(n.x,n.y),e.lineTo(r.x,r.y),e.stroke()},hit:function(t){e.lineWidth=1;var n=Math.round(255*(1-t.phase)).toString(16).padStart(2,"0");console.log(n),e.strokeStyle="#".concat(n).concat(n).concat(n);var r=i(t.position);e.beginPath(),e.arc(r.x,r.y,20*t.phase,0,2*Math.PI,!1),e.stroke()},centreGraduation:function(){e.strokeStyle="#333333",e.lineWidth=1,e.beginPath(),e.moveTo(0,Math.floor(o/2)+.5),e.lineTo(r,Math.floor(o/2)+.5),e.moveTo(Math.floor(r/2)+.5,0),e.lineTo(Math.floor(r/2)+.5,o),e.stroke()},text:function(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"white";e.fillStyle=o,e.fillText(t,n,r)},grid:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;e.strokeStyle="#555555",e.lineWidth=1,e.beginPath();for(var i=0;i<r+n;i+=n){var c=Math.floor(i+(r/2-t.x)%n);a(c)}for(var l=0;l<o+n;l+=n){var s=Math.floor(l+(o/2-t.y)%n);u(s)}e.stroke(),e.fillStyle="white";for(var f=0;f<r+n;f+=100){var m=f+(r/2-t.x)%n;e.fillText((Math.ceil((t.x-r/2+f)/n)*n).toFixed(0).toString(),m,100)}for(var h=0;h<o+n;h+=100){var d=h+(o/2-t.y)%n;e.fillText((Math.ceil((t.y-o/2+h)/n)*n).toFixed(0).toString(),5,d)}}}},d=n(30).connect(Object({NODE_ENV:"production",PUBLIC_URL:"/asteroids"}).REACT_APP_SOCKET||"https://asteroids.yarekt.co.uk"),v=r.createContext(d).Consumer,w=function(){var e=new Array,t=new Array,n=new Array,r=0,o=new Array,i=new Array,a="Debug",c=function(e){return String(Math.round(e)).padStart(3)};return{debug:function(){return a},hits:function(){return n.forEach((function(e){return e.phase+=1/60})),n=n.filter((function(e){return e.phase<1}))},addHit:function(e){n.push({position:e.position,phase:0})},incrementScore:function(){return r++},decrementScore:function(){return r--},score:function(){return r},ships:function(t){return e},shells:function(){return t},update:function(n){e=n.ships,t=n.shells;var r=Date.now()-n.time;o.unshift(n.simulationTime),o.length>60&&o.pop();var u=o.reduce((function(e,t){return e+t}),0)/60;i.unshift(n.sendTime),i.length>60&&i.pop();var l=i.reduce((function(e,t){return e+t}),0)/60;a="Delay: ".concat(c(r),"ms Simulation time: ").concat(c(n.simulationTime),"ms (").concat(c(u),"ms) ").concat(c(u/16.6*100),"%, sendTime: ").concat(c(n.sendTime),"ms (").concat(c(l),"ms) ").concat(c(l/16.6*100),"%, Inter-frame delay: ").concat(c(n.frameGap),"ms")}}}(),y=r.createContext(w),p=y.Consumer,g=function(){return r.createElement("div",{className:"App"},r.createElement("header",{className:"App-header"},r.createElement(p,null,(function(e){return r.createElement(r.Fragment,null,r.createElement(m,{world:e,zoom:1}),r.createElement(v,null,(function(e){return r.createElement(l,{socket:e})})))}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(o.a.createElement((function(e){var t=e.children;return r.createElement(y.Provider,{value:w},r.createElement(v,null,(function(e){return e.on("update",(function(e){w.update(e)})),e.on("shellHitShip",(function(t){w.addHit(t),t.target===e.id?w.decrementScore():t.owner===e.id&&w.incrementScore()})),r.createElement(r.Fragment,null,t)})))}),null,o.a.createElement(g,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[31,1,2]]]);
//# sourceMappingURL=main.ec404c98.chunk.js.map